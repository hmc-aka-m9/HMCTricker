import React, { useState, useEffect } from 'react';
import { Menu, X, Settings, Plus, Edit2, Trash2, Save, LogOut, DollarSign, Lock, Users, ShoppingCart, Gift, Palette, Ticket } from 'lucide-react';

const App = () => {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [isAdmin, setIsAdmin] = useState(false);
  const [showLoginModal, setShowLoginModal] = useState(false);
  const [showRegisterModal, setShowRegisterModal] = useState(false);
  const [showDepositModal, setShowDepositModal] = useState(false);
  const [showChangePasswordModal, setShowChangePasswordModal] = useState(false);
  const [showSpinWheel, setShowSpinWheel] = useState(false);
  const [currentUser, setCurrentUser] = useState(null);
  const [menuOpen, setMenuOpen] = useState(false);
  const [activeTab, setActiveTab] = useState('services');

  // State cho admin
  const [editingService, setEditingService] = useState(null);
  const [editingCategory, setEditingCategory] = useState(null);
  const [showServiceModal, setShowServiceModal] = useState(false);
  const [showCategoryModal, setShowCategoryModal] = useState(false);
  const [showPrizeModal, setShowPrizeModal] = useState(false);
  const [editingPrize, setEditingPrize] = useState(null);

  // D·ªØ li·ªáu m·∫∑c ƒë·ªãnh
  const [users, setUsers] = useState([
    { id: 1, username: 'admin', password: 'admin123', role: 'admin', balance: 10000000, spinCount: 5 },
    { id: 2, username: 'user1', password: 'user123', role: 'user', balance: 500000, spinCount: 3 }
  ]);

  const [themeColors, setThemeColors] = useState({
    primary: '#FF6B6B',
    secondary: '#4ECDC4',
    accent: '#FFE66D',
    background: '#0F172A',
    cardBg: '#1E293B',
    textPrimary: '#F1F5F9',
    textSecondary: '#94A3B8'
  });

  const [categories, setCategories] = useState([
    { id: 1, name: 'DAME C√ÅC LO·∫†I', icon: 'üíé', order: 1 },
    { id: 2, name: 'UNLOCK & KH√ÅNG NGH·ªä', icon: 'üîì', order: 2 },
    { id: 3, name: 'D·ªäCH V·ª§ TICK XANH', icon: '‚úÖ', order: 3 },
    { id: 4, name: 'TƒÇNG T∆Ø∆†NG T√ÅC FACEBOOK', icon: 'üì±', order: 4 },
    { id: 5, name: 'TƒÇNG T∆Ø∆†NG T√ÅC TIKTOK', icon: 'üéµ', order: 5 },
    { id: 6, name: 'TƒÇNG T∆Ø∆†NG T√ÅC INSTAGRAM', icon: 'üì∑', order: 6 },
    { id: 7, name: 'D·ªäCH V·ª§ TƒÇNG T∆Ø∆†NG T√ÅC KH√ÅC', icon: 'üõçÔ∏è', order: 7 },
    { id: 8, name: 'D·ªäCH V·ª§ KHO√Å H·ªåC', icon: 'üìí', order: 8 }
  ]);

  const [services, setServices] = useState([
    // DAME C√ÅC LO·∫†I
    { id: 1, categoryId: 1, name: 'Dame T√†i Kho·∫£n Facebook TCN Th∆∞·ªùng', minPrice: 300000, maxPrice: 1500000 },
    { id: 2, categoryId: 1, name: 'Dame T√†i Kho·∫£n Facebook Chuy√™n Nghi·ªáp', minPrice: 450000, maxPrice: 1700000 },
    { id: 3, categoryId: 1, name: 'Dame T√†i Kho·∫£n Facebook Locked', minPrice: 500000, maxPrice: 1500000 },
    { id: 4, categoryId: 1, name: 'Dame T√†i Kho·∫£n Facebook Kh√¥ng AVT', minPrice: 400000, maxPrice: 1900000 },
    { id: 5, categoryId: 1, name: 'Dame Fanpage Facebook', minPrice: 800000, maxPrice: 3000000 },
    { id: 6, categoryId: 1, name: 'Dame Group Facebook', minPrice: 1000000, maxPrice: 8000000 },
    { id: 7, categoryId: 1, name: 'Dame T√†i Kho·∫£n TikTok', minPrice: 600000, maxPrice: 4000000 },
    { id: 8, categoryId: 1, name: 'Dame Video TikTok', minPrice: 500000, maxPrice: 3000000 },
    { id: 9, categoryId: 1, name: 'Dame T√†i Kho·∫£n Instagram', minPrice: 350000, maxPrice: 2000000 },
    { id: 10, categoryId: 1, name: 'Dame T√†i Kho·∫£n Youtube', minPrice: 1000000, maxPrice: 9000000 },
    { id: 11, categoryId: 1, name: 'Dame Video Youtube', minPrice: 800000, maxPrice: 5000000 },
    { id: 12, categoryId: 1, name: 'Dame T√†i Kho·∫£n Threads', minPrice: 500000, maxPrice: 2500000 },
    
    // UNLOCK & KH√ÅNG NGH·ªä
    { id: 13, categoryId: 2, name: 'M·ªü Kh√≥a Facebook D·∫°ng K√©t Ch√≠nh Ch·ªß', minPrice: 650000, maxPrice: 650000 },
    { id: 14, categoryId: 2, name: 'M·ªü Kh√≥a Facebook D·∫°ng K√©t Ko Ch√≠nh Ch·ªß', minPrice: 2500000, maxPrice: 2500000 },
    { id: 15, categoryId: 2, name: 'M·ªü Kh√≥a Facebook ƒê√¨nh Ch·ªâ L·∫ßn ƒê·∫ßu', minPrice: 650000, maxPrice: 650000 },
    { id: 16, categoryId: 2, name: 'M·ªü Kh√≥a Facebook ƒê√¨nh Ch·ªâ L·∫ßn 2 Tr·ªü L√™n', minPrice: 2500000, maxPrice: 2500000 },
    { id: 17, categoryId: 2, name: 'M·ªü Kh√≥a Facebook FAQ V√¥ Hi·ªáu H√≥a', minPrice: 8500000, maxPrice: 8500000 },
    { id: 18, categoryId: 2, name: 'Kh√°ng Vi Ph·∫°m Facebook', minPrice: 1000000, maxPrice: 1000000 },
    { id: 19, categoryId: 2, name: 'L·∫•y L·∫°i Facebook B·ªã Hack', minPrice: 850000, maxPrice: 850000 },
    { id: 20, categoryId: 2, name: 'Verify B·∫£o V·ªá T√†i Kho·∫£n Facebook', minPrice: 2500000, maxPrice: 2500000 },
    { id: 21, categoryId: 2, name: 'M·ªü Kh√≥a TikTok C·∫•m Vƒ©nh Vi·ªÖn', minPrice: 3000000, maxPrice: 3000000 },
    { id: 22, categoryId: 2, name: 'M·ªü Kh√≥a TikTok Die B·∫£n Quy·ªÅn', minPrice: 30000000, maxPrice: 30000000 },
    { id: 23, categoryId: 2, name: 'M·ªü Kh√≥a TikTok Gi·ªõi H·∫°n ƒê·ªô Tu·ªïi', minPrice: 650000, maxPrice: 650000 },
    { id: 24, categoryId: 2, name: 'Khi·∫øu N·∫°i Video TikTok', minPrice: 1000000, maxPrice: 1000000 },
    { id: 25, categoryId: 2, name: 'B·∫£o K√™ T√†i Kho·∫£n TikTok', minPrice: 0, maxPrice: 0, isNegotiable: true },
    { id: 26, categoryId: 2, name: 'T√†i Kho·∫£n Agency TikTok', minPrice: 5000000, maxPrice: 5000000 },
    { id: 27, categoryId: 2, name: 'M·ªü Kh√≥a T√†i Kho·∫£n Instagram', minPrice: 950000, maxPrice: 950000 },
    { id: 28, categoryId: 2, name: 'Kh√°ng Ngh·ªã Video Youtube', minPrice: 3000000, maxPrice: 5000000 },
    { id: 29, categoryId: 2, name: 'Kh√°ng Ngh·ªã B√†i vi·∫øt Instagram', minPrice: 900000, maxPrice: 900000 },
    
    // D·ªäCH V·ª§ TICK XANH
    { id: 30, categoryId: 3, name: 'L√™n Tick Xanh Profile Facebook KBH', minPrice: 999000, maxPrice: 999000 },
    { id: 31, categoryId: 3, name: 'L√™n Tick Xanh Profile Facebook BH', minPrice: 1850000, maxPrice: 1850000 },
    { id: 32, categoryId: 3, name: 'L√™n Tick Xanh Profile Facebook Ch√≠nh Ch·ªß KBH', minPrice: 3600000, maxPrice: 3600000 },
    { id: 33, categoryId: 3, name: 'L√™n Tick Xanh Profile Facebook Ch√≠nh Ch·ªß BH', minPrice: 5500000, maxPrice: 5500000 },
    { id: 34, categoryId: 3, name: 'L√™n Tick Xanh Profile Instagram BH', minPrice: 3850000, maxPrice: 3850000 },
    { id: 35, categoryId: 3, name: 'L√™n Tick Xanh Profile Instagram Ch√≠nh Ch·ªß BH', minPrice: 7500000, maxPrice: 7500000 },
    
    // TƒÇNG T∆Ø∆†NG T√ÅC FACEBOOK
    { id: 36, categoryId: 4, name: 'TƒÉng C·∫£m S√∫c Facebook', minPrice: 25000, maxPrice: 25000, unit: '1.000 T∆∞∆°ng T√°c' },
    { id: 37, categoryId: 4, name: 'TƒÉng Follow Facebook', minPrice: 30000, maxPrice: 30000, unit: '1.000 T∆∞∆°ng T√°c' },
    { id: 38, categoryId: 4, name: 'TƒÉng M·∫Øt Live Facebook', minPrice: 100000, maxPrice: 100000, unit: '1.000 T∆∞∆°ng T√°c' },
    { id: 39, categoryId: 4, name: 'TƒÉng ƒê√°nh Gi√° Fanpage', minPrice: 100000, maxPrice: 100000, unit: '1.000 T∆∞∆°ng T√°c' },
    { id: 40, categoryId: 4, name: 'TƒÉng View Story', minPrice: 20000, maxPrice: 20000, unit: '1.000 T∆∞∆°ng T√°c' },
    { id: 41, categoryId: 4, name: 'TƒÉng T∆∞∆°ng T√°c To√†n Di·ªán', minPrice: 0, maxPrice: 0, isNegotiable: true },
    
    // TƒÇNG T∆Ø∆†NG T√ÅC TIKTOK
    { id: 42, categoryId: 5, name: 'TƒÉng Tim TikTok', minPrice: 20000, maxPrice: 20000, unit: '1.000 T∆∞∆°ng T√°c' },
    { id: 43, categoryId: 5, name: 'TƒÉng Follow TikTok', minPrice: 50000, maxPrice: 50000, unit: '1.000 T∆∞∆°ng T√°c' },
    { id: 44, categoryId: 5, name: 'TƒÉng M·∫Øt Live TikTok', minPrice: 150000, maxPrice: 150000, unit: '1.000 T∆∞∆°ng T√°c' },
    { id: 45, categoryId: 5, name: 'TƒÉng View TikTok', minPrice: 1000, maxPrice: 1000, unit: '1.000 T∆∞∆°ng T√°c' },
    
    // TƒÇNG T∆Ø∆†NG T√ÅC INSTAGRAM
    { id: 46, categoryId: 6, name: 'TƒÉng Tim Instagram', minPrice: 25000, maxPrice: 25000, unit: '1.000 T∆∞∆°ng T√°c' },
    { id: 47, categoryId: 6, name: 'TƒÉng Follow Instagram', minPrice: 35000, maxPrice: 35000, unit: '1.000 T∆∞∆°ng T√°c' },
    { id: 48, categoryId: 6, name: 'TƒÉng M·∫Øt Live Instagram', minPrice: 150000, maxPrice: 150000, unit: '1.000 T∆∞∆°ng T√°c' },
    { id: 49, categoryId: 6, name: 'TƒÉng View Instagram', minPrice: 1000, maxPrice: 1000, unit: '1.000 T∆∞∆°ng T√°c' },
    
    // D·ªäCH V·ª§ TƒÇNG T∆Ø∆†NG T√ÅC KH√ÅC
    { id: 50, categoryId: 7, name: 'TƒÉng Follow Shopee', minPrice: 0, maxPrice: 0, isNegotiable: true },
    { id: 51, categoryId: 7, name: 'TƒÉng Tim Shopee', minPrice: 0, maxPrice: 0, isNegotiable: true },
    { id: 52, categoryId: 7, name: 'TƒÉng M·∫Øt Live Shopee', minPrice: 0, maxPrice: 0, isNegotiable: true },
    { id: 53, categoryId: 7, name: 'TƒÉng ƒê√°nh Gi√° Google Maps', minPrice: 0, maxPrice: 0, isNegotiable: true },
    { id: 54, categoryId: 7, name: 'X√°c minh Google Maps', minPrice: 0, maxPrice: 0, isNegotiable: true },
    { id: 55, categoryId: 7, name: 'D·ªãch V·ª• Telegram', minPrice: 0, maxPrice: 0, isNegotiable: true },
    
    // D·ªäCH V·ª§ KHO√Å H·ªåC
    { id: 56, categoryId: 8, name: 'D·ªãch v·ª• Facebook', minPrice: 0, maxPrice: 0, isNegotiable: true }
  ]);

  const [prizes, setPrizes] = useState([
    { id: 1, discount: 10, probability: 40, color: '#FFD700', categoryIds: [] },
    { id: 2, discount: 15, probability: 25, color: '#FF6B6B', categoryIds: [1, 2] },
    { id: 3, discount: 20, probability: 15, color: '#4ECDC4', categoryIds: [3, 4] },
    { id: 4, discount: 25, probability: 10, color: '#95E1D3', categoryIds: [5, 6] },
    { id: 5, discount: 30, probability: 5, color: '#F38181', categoryIds: [7] },
    { id: 6, discount: 40, probability: 3, color: '#AA96DA', categoryIds: [] },
    { id: 7, discount: 50, probability: 2, color: '#FCBAD3', categoryIds: [] }
  ]);

  const formatPrice = (price) => {
    return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price);
  };

  const handleLogin = (username, password) => {
    const user = users.find(u => u.username === username && u.password === password);
    if (user) {
      setCurrentUser(user);
      setIsLoggedIn(true);
      setIsAdmin(user.role === 'admin');
      setShowLoginModal(false);
      return true;
    }
    return false;
  };

  const handleRegister = (username, password) => {
    if (users.find(u => u.username === username)) {
      return false;
    }
    const newUser = {
      id: users.length + 1,
      username,
      password,
      role: 'user',
      balance: 0,
      spinCount: 1
    };
    setUsers([...users, newUser]);
    return true;
  };

  const handleDeposit = (amount) => {
    if (currentUser) {
      const updatedUsers = users.map(u => 
        u.id === currentUser.id ? { ...u, balance: u.balance + amount, spinCount: u.spinCount + Math.floor(amount / 100000) } : u
      );
      setUsers(updatedUsers);
      setCurrentUser({ ...currentUser, balance: currentUser.balance + amount, spinCount: currentUser.spinCount + Math.floor(amount / 100000) });
    }
  };

  const handleChangePassword = (oldPassword, newPassword) => {
    if (currentUser && currentUser.password === oldPassword) {
      const updatedUsers = users.map(u => 
        u.id === currentUser.id ? { ...u, password: newPassword } : u
      );
      setUsers(updatedUsers);
      setCurrentUser({ ...currentUser, password: newPassword });
      return true;
    }
    return false;
  };

  const handleSpin = () => {
    if (!currentUser || currentUser.spinCount <= 0) return null;

    const random = Math.random() * 100;
    let cumulative = 0;
    let wonPrize = null;

    for (const prize of prizes) {
      cumulative += prize.probability;
      if (random <= cumulative) {
        wonPrize = prize;
        break;
      }
    }

    const updatedUsers = users.map(u => 
      u.id === currentUser.id ? { ...u, spinCount: u.spinCount - 1 } : u
    );
    setUsers(updatedUsers);
    setCurrentUser({ ...currentUser, spinCount: currentUser.spinCount - 1 });

    return wonPrize;
  };

  // Component Login Modal
  const LoginModal = () => {
    const [username, setUsername] = useState('');
    const [password, setPassword] = useState('');
    const [error, setError] = useState('');

    const handleSubmit = (e) => {
      e.preventDefault();
      if (handleLogin(username, password)) {
        setError('');
      } else {
        setError('Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!');
      }
    };

    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={() => setShowLoginModal(false)}>
        <div className="bg-gray-800 p-8 rounded-lg w-96" onClick={e => e.stopPropagation()} style={{ backgroundColor: themeColors.cardBg }}>
          <h2 className="text-2xl font-bold mb-6" style={{ color: themeColors.primary }}>ƒêƒÉng Nh·∫≠p</h2>
          {error && <p className="text-red-500 mb-4">{error}</p>}
          <form onSubmit={handleSubmit}>
            <input
              type="text"
              placeholder="T√™n ƒëƒÉng nh·∫≠p"
              className="w-full p-3 mb-4 rounded bg-gray-700 text-white"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              required
            />
            <input
              type="password"
              placeholder="M·∫≠t kh·∫©u"
              className="w-full p-3 mb-6 rounded bg-gray-700 text-white"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
            />
            <button type="submit" className="w-full p-3 rounded font-bold" style={{ backgroundColor: themeColors.primary }}>
              ƒêƒÉng Nh·∫≠p
            </button>
          </form>
        </div>
      </div>
    );
  };

  // Component Register Modal
  const RegisterModal = () => {
    const [username, setUsername] = useState('');
    const [password, setPassword] = useState('');
    const [confirmPassword, setConfirmPassword] = useState('');
    const [error, setError] = useState('');

    const handleSubmit = (e) => {
      e.preventDefault();
      if (password !== confirmPassword) {
        setError('M·∫≠t kh·∫©u kh√¥ng kh·ªõp!');
        return;
      }
      if (handleRegister(username, password)) {
        setError('');
        alert('ƒêƒÉng k√Ω th√†nh c√¥ng!');
        setShowRegisterModal(false);
      } else {
        setError('T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i!');
      }
    };

    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={() => setShowRegisterModal(false)}>
        <div className="bg-gray-800 p-8 rounded-lg w-96" onClick={e => e.stopPropagation()} style={{ backgroundColor: themeColors.cardBg }}>
          <h2 className="text-2xl font-bold mb-6" style={{ color: themeColors.primary }}>ƒêƒÉng K√Ω</h2>
          {error && <p className="text-red-500 mb-4">{error}</p>}
          <form onSubmit={handleSubmit}>
            <input
              type="text"
              placeholder="T√™n ƒëƒÉng nh·∫≠p"
              className="w-full p-3 mb-4 rounded bg-gray-700 text-white"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              required
            />
            <input
              type="password"
              placeholder="M·∫≠t kh·∫©u"
              className="w-full p-3 mb-4 rounded bg-gray-700 text-white"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
            />
            <input
              type="password"
              placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u"
              className="w-full p-3 mb-6 rounded bg-gray-700 text-white"
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
              required
            />
            <button type="submit" className="w-full p-3 rounded font-bold" style={{ backgroundColor: themeColors.primary }}>
              ƒêƒÉng K√Ω
            </button>
          </form>
        </div>
      </div>
    );
  };

  // Component Deposit Modal
  const DepositModal = () => {
    const [amount, setAmount] = useState('');

    const handleSubmit = (e) => {
      e.preventDefault();
      const depositAmount = parseInt(amount);
      if (depositAmount > 0) {
        handleDeposit(depositAmount);
        alert(`N·∫°p th√†nh c√¥ng ${formatPrice(depositAmount)}! B·∫°n nh·∫≠n ƒë∆∞·ª£c ${Math.floor(depositAmount / 100000)} l∆∞·ª£t quay.`);
        setShowDepositModal(false);
        setAmount('');
      }
    };

    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={() => setShowDepositModal(false)}>
        <div className="bg-gray-800 p-8 rounded-lg w-96" onClick={e => e.stopPropagation()} style={{ backgroundColor: themeColors.cardBg }}>
          <h2 className="text-2xl font-bold mb-6" style={{ color: themeColors.primary }}>N·∫°p Ti·ªÅn</h2>
          <p className="mb-4" style={{ color: themeColors.textSecondary }}>M·ªói 100.000ƒë = 1 l∆∞·ª£t quay</p>
          <form onSubmit={handleSubmit}>
            <input
              type="number"
              placeholder="S·ªë ti·ªÅn c·∫ßn n·∫°p"
              className="w-full p-3 mb-6 rounded bg-gray-700 text-white"
              value={amount}
              onChange={(e) => setAmount(e.target.value)}
              required
            />
            <button type="submit" className="w-full p-3 rounded font-bold" style={{ backgroundColor: themeColors.primary }}>
              N·∫°p Ti·ªÅn
            </button>
          </form>
        </div>
      </div>
    );
  };

  // Component Change Password Modal
  const ChangePasswordModal = () => {
    const [oldPassword, setOldPassword] = useState('');
    const [newPassword, setNewPassword] = useState('');
    const [confirmPassword, setConfirmPassword] = useState('');
    const [error, setError] = useState('');

    const handleSubmit = (e) => {
      e.preventDefault();
      if (newPassword !== confirmPassword) {
        setError('M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp!');
        return;
      }
      if (handleChangePassword(oldPassword, newPassword)) {
        alert('ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!');
        setShowChangePasswordModal(false);
        setOldPassword('');
        setNewPassword('');
        setConfirmPassword('');
        setError('');
      } else {
        setError('M·∫≠t kh·∫©u c≈© kh√¥ng ƒë√∫ng!');
      }
    };

    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={() => setShowChangePasswordModal(false)}>
        <div className="bg-gray-800 p-8 rounded-lg w-96" onClick={e => e.stopPropagation()} style={{ backgroundColor: themeColors.cardBg }}>
          <h2 className="text-2xl font-bold mb-6" style={{ color: themeColors.primary }}>ƒê·ªïi M·∫≠t Kh·∫©u</h2>
          {error && <p className="text-red-500 mb-4">{error}</p>}
          <form onSubmit={handleSubmit}>
            <input
              type="password"
              placeholder="M·∫≠t kh·∫©u c≈©"
              className="w-full p-3 mb-4 rounded bg-gray-700 text-white"
              value={oldPassword}
              onChange={(e) => setOldPassword(e.target.value)}
              required
            />
            <input
              type="password"
              placeholder="M·∫≠t kh·∫©u m·ªõi"
              className="w-full p-3 mb-4 rounded bg-gray-700 text-white"
              value={newPassword}
              onChange={(e) => setNewPassword(e.target.value)}
              required
            />
            <input
              type="password"
              placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi"
              className="w-full p-3 mb-6 rounded bg-gray-700 text-white"
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
              required
            />
            <button type="submit" className="w-full p-3 rounded font-bold" style={{ backgroundColor: themeColors.primary }}>
              ƒê·ªïi M·∫≠t Kh·∫©u
            </button>
          </form>
        </div>
      </div>
    );
  };

  // Component Spin Wheel
  const SpinWheel = () => {
    const [spinning, setSpinning] = useState(false);
    const [result, setResult] = useState(null);
    const [rotation, setRotation] = useState(0);

    const handleSpinClick = () => {
      if (spinning || !currentUser || currentUser.spinCount <= 0) return;

      setSpinning(true);
      setResult(null);

      const prize = handleSpin();
      const randomRotation = 360 * 5 + (360 / prizes.length) * prizes.findIndex(p => p.id === prize.id);
      setRotation(rotation + randomRotation);

      setTimeout(() => {
        setSpinning(false);
        setResult(prize);
      }, 3000);
    };

    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={() => !spinning && setShowSpinWheel(false)}>
        <div className="bg-gray-800 p-8 rounded-lg max-w-2xl w-full" onClick={e => e.stopPropagation()} style={{ backgroundColor: themeColors.cardBg }}>
          <h2 className="text-3xl font-bold mb-6 text-center" style={{ color: themeColors.primary }}>üé∞ V√≤ng Quay May M·∫Øn</h2>
          
          <div className="relative w-80 h-80 mx-auto mb-6">
            <div 
              className="w-full h-full rounded-full border-8 border-yellow-400 relative overflow-hidden transition-transform duration-3000 ease-out"
              style={{ transform: `rotate(${rotation}deg)` }}
            >
              {prizes.map((prize, index) => (
                <div
                  key={prize.id}
                  className="absolute w-full h-full"
                  style={{
                    transform: `rotate(${(360 / prizes.length) * index}deg)`,
                    clipPath: 'polygon(50% 50%, 50% 0%, 100% 0%)',
                    transformOrigin: 'center',
                    backgroundColor: prize.color
                  }}
                >
                  <div className="absolute top-10 left-1/2 transform -translate-x-1/2 text-white font-bold text-lg">
                    -{prize.discount}%
                  </div>
                </div>
              ))}
              <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-white rounded-full flex items-center justify-center text-2xl font-bold" style={{ color: themeColors.primary }}>
                SPIN
              </div>
            </div>
            <div className="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-2 w-0 h-0 border-l-8 border-r-8 border-t-16 border-l-transparent border-r-transparent border-t-red-600 z-10"></div>
          </div>

          <div className="text-center mb-6">
            <p className="text-xl mb-2" style={{ color: themeColors.textPrimary }}>
              L∆∞·ª£t quay c√≤n l·∫°i: <span className="font-bold" style={{ color: themeColors.accent }}>{currentUser?.spinCount || 0}</span>
            </p>
            {result && (
              <div className="mt-4 p-4 rounded-lg" style={{ backgroundColor: result.color }}>
                <p className="text-2xl font-bold text-white">
                  üéâ Ch√∫c m·ª´ng! B·∫°n nh·∫≠n ƒë∆∞·ª£c gi·∫£m gi√° {result.discount}%
                </p>
                {result.categoryIds.length > 0 && (
                  <p className="text-sm text-white mt-2">
                    √Åp d·ª•ng cho: {result.categoryIds.map(id => categories.find(c => c.id === id)?.name).join(', ')}
                  </p>
                )}
                {result.categoryIds.length === 0 && (
                  <p className="text-sm text-white mt-2">√Åp d·ª•ng cho t·∫•t c·∫£ d·ªãch v·ª•</p>
                )}
              </div>
            )}
          </div>

          <button
            onClick={handleSpinClick}
            disabled={spinning || !currentUser || currentUser.spinCount <= 0}
            className="w-full p-4 rounded-lg font-bold text-xl disabled:opacity-50 disabled:cursor-not-allowed"
            style={{ backgroundColor: themeColors.primary }}
          >
            {spinning ? 'üé∞ ƒêang quay...' : 'QUAY NGAY!'}
          </button>
        </div>
      </div>
    );
  };

  // Admin Components
  const AdminPanel = () => {
    const [selectedTab, setSelectedTab] = useState('services');

    return (
      <div className="min-h-screen p-6" style={{ backgroundColor: themeColors.background }}>
        <div className="max-w-7xl mx-auto">
          <h1 className="text-4xl font-bold mb-8" style={{ color: themeColors.primary }}>
            <Settings className="inline mr-3" /> Qu·∫£n Tr·ªã H·ªá Th·ªëng
          </h1>

          <div className="flex gap-4 mb-6">
            <button
              onClick={() => setSelectedTab('services')}
              className={`px-6 py-3 rounded-lg font-semibold ${selectedTab === 'services' ? 'opacity-100' : 'opacity-50'}`}
              style={{ backgroundColor: themeColors.primary }}
            >
              <ShoppingCart className="inline mr-2" size={20} /> Qu·∫£n L√Ω D·ªãch V·ª•
            </button>
            <button
              onClick={() => setSelectedTab('categories')}
              className={`px-6 py-3 rounded-lg font-semibold ${selectedTab === 'categories' ? 'opacity-100' : 'opacity-50'}`}
              style={{ backgroundColor: themeColors.secondary }}
            >
              <Menu className="inline mr-2" size={20} /> Qu·∫£n L√Ω Danh M·ª•c
            </button>
            <button
              onClick={() => setSelectedTab('prizes')}
              className={`px-6 py-3 rounded-lg font-semibold ${selectedTab === 'prizes' ? 'opacity-100' : 'opacity-50'}`}
              style={{ backgroundColor: themeColors.accent, color: themeColors.background }}
            >
              <Gift className="inline mr-2" size={20} /> Qu·∫£n L√Ω Gi·∫£i Th∆∞·ªüng
            </button>
            <button
              onClick={() => setSelectedTab('theme')}
              className={`px-6 py-3 rounded-lg font-semibold ${selectedTab === 'theme' ? 'opacity-100' : 'opacity-50'}`}
              style={{ backgroundColor: '#9333EA' }}
            >
              <Palette className="inline mr-2" size={20} /> T√πy Ch·ªânh M√†u S·∫Øc
            </button>
            <button
              onClick={() => setSelectedTab('users')}
              className={`px-6 py-3 rounded-lg font-semibold ${selectedTab === 'users' ? 'opacity-100' : 'opacity-50'}`}
              style={{ backgroundColor: '#F59E0B' }}
            >
              <Users className="inline mr-2" size={20} /> Qu·∫£n L√Ω Users
            </button>
          </div>

          {selectedTab === 'services' && <ServiceManagement />}
          {selectedTab === 'categories' && <CategoryManagement />}
          {selectedTab === 'prizes' && <PrizeManagement />}
          {selectedTab === 'theme' && <ThemeCustomization />}
          {selectedTab === 'users' && <UserManagement />}
        </div>
      </div>
    );
  };

  const ServiceManagement = () => {
    const handleAddService = () => {
      setEditingService({ id: null, categoryId: categories[0]?.id || 1, name: '', minPrice: 0, maxPrice: 0, unit: '', isNegotiable: false });
      setShowServiceModal(true);
    };

    const handleEditService = (service) => {
      setEditingService(service);
      setShowServiceModal(true);
    };

    const handleDeleteService = (id) => {
      if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a d·ªãch v·ª• n√†y?')) {
        setServices(services.filter(s => s.id !== id));
      }
    };

    const handleSaveService = () => {
      if (editingService.id) {
        setServices(services.map(s => s.id === editingService.id ? editingService : s));
      } else {
        setServices([...services, { ...editingService, id: Math.max(...services.map(s => s.id)) + 1 }]);
      }
      setShowServiceModal(false);
      setEditingService(null);
    };

    return (
      <div>
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-2xl font-bold" style={{ color: themeColors.textPrimary }}>Danh S√°ch D·ªãch V·ª•</h2>
          <button
            onClick={handleAddService}
            className="px-6 py-3 rounded-lg font-semibold flex items-center gap-2"
            style={{ backgroundColor: themeColors.primary }}
          >
            <Plus size={20} /> Th√™m D·ªãch V·ª•
          </button>
        </div>

        {categories.map(category => (
          <div key={category.id} className="mb-8 p-6 rounded-lg" style={{ backgroundColor: themeColors.cardBg }}>
            <h3 className="text-xl font-bold mb-4" style={{ color: themeColors.secondary }}>
              {category.icon} {category.name}
            </h3>
            <div className="space-y-3">
              {services.filter(s => s.categoryId === category.id).map(service => (
                <div key={service.id} className="flex items-center justify-between p-4 rounded bg-gray-700">
                  <div className="flex-1">
                    <p className="font-semibold" style={{ color: themeColors.textPrimary }}>{service.name}</p>
                    <p className="text-sm" style={{ color: themeColors.textSecondary }}>
                      {service.isNegotiable ? 'Th∆∞∆°ng L∆∞·ª£ng' : 
                        service.minPrice === service.maxPrice ? 
                          `${formatPrice(service.minPrice)}${service.unit ? ' / ' + service.unit : ''}` :
                          `${formatPrice(service.minPrice)} - ${formatPrice(service.maxPrice)}${service.unit ? ' / ' + service.unit : ''}`
                      }
                    </p>
                  </div>
                  <div className="flex gap-2">
                    <button onClick={() => handleEditService(service)} className="p-2 rounded" style={{ backgroundColor: themeColors.secondary }}>
                      <Edit2 size={18} />
                    </button>
                    <button onClick={() => handleDeleteService(service.id)} className="p-2 rounded bg-red-600">
                      <Trash2 size={18} />
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))}

        {showServiceModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={() => setShowServiceModal(false)}>
            <div className="bg-gray-800 p-8 rounded-lg w-full max-w-2xl" onClick={e => e.stopPropagation()} style={{ backgroundColor: themeColors.cardBg }}>
              <h2 className="text-2xl font-bold mb-6" style={{ color: themeColors.primary }}>
                {editingService?.id ? 'Ch·ªânh S·ª≠a D·ªãch V·ª•' : 'Th√™m D·ªãch V·ª• M·ªõi'}
              </h2>
              
              <div className="space-y-4">
                <div>
                  <label className="block mb-2" style={{ color: themeColors.textPrimary }}>Danh M·ª•c</label>
                  <select
                    value={editingService.categoryId}
                    onChange={(e) => setEditingService({ ...editingService, categoryId: parseInt(e.target.value) })}
                    className="w-full p-3 rounded bg-gray-700 text-white"
                  >
                    {categories.map(cat => (
                      <option key={cat.id} value={cat.id}>{cat.icon} {cat.name}</option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="block mb-2" style={{ color: themeColors.textPrimary }}>T√™n D·ªãch V·ª•</label>
                  <input
                    type="text"
                    value={editingService.name}
                    onChange={(e) => setEditingService({ ...editingService, name: e.target.value })}
                    className="w-full p-3 rounded bg-gray-700 text-white"
                    placeholder="Nh·∫≠p t√™n d·ªãch v·ª•"
                  />
                </div>

                <div className="flex items-center gap-4">
                  <input
                    type="checkbox"
                    checked={editingService.isNegotiable || false}
                    onChange={(e) => setEditingService({ ...editingService, isNegotiable: e.target.checked })}
                    id="negotiable"
                  />
                  <label htmlFor="negotiable" style={{ color: themeColors.textPrimary }}>Gi√° th∆∞∆°ng l∆∞·ª£ng</label>
                </div>

                {!editingService.isNegotiable && (
                  <>
                    <div>
                      <label className="block mb-2" style={{ color: themeColors.textPrimary }}>Gi√° Th·∫•p Nh·∫•t</label>
                      <input
                        type="number"
                        value={editingService.minPrice}
                        onChange={(e) => setEditingService({ ...editingService, minPrice: parseInt(e.target.value) || 0 })}
                        className="w-full p-3 rounded bg-gray-700 text-white"
                        placeholder="0"
                      />
                    </div>

                    <div>
                      <label className="block mb-2" style={{ color: themeColors.textPrimary }}>Gi√° Cao Nh·∫•t</label>
                      <input
                        type="number"
                        value={editingService.maxPrice}
                        onChange={(e) => setEditingService({ ...editingService, maxPrice: parseInt(e.target.value) || 0 })}
                        className="w-full p-3 rounded bg-gray-700 text-white"
                        placeholder="0"
                      />
                    </div>

                    <div>
                      <label className="block mb-2" style={{ color: themeColors.textPrimary }}>ƒê∆°n V·ªã (t√πy ch·ªçn)</label>
                      <input
                        type="text"
                        value={editingService.unit || ''}
                        onChange={(e) => setEditingService({ ...editingService, unit: e.target.value })}
                        className="w-full p-3 rounded bg-gray-700 text-white"
                        placeholder="VD: 1.000 T∆∞∆°ng T√°c"
                      />
                    </div>
                  </>
                )}

                <div className="flex gap-4 mt-6">
                  <button onClick={handleSaveService} className="flex-1 p-3 rounded font-bold" style={{ backgroundColor: themeColors.primary }}>
                    <Save className="inline mr-2" size={20} /> L∆∞u
                  </button>
                  <button onClick={() => setShowServiceModal(false)} className="flex-1 p-3 rounded font-bold bg-gray-600">
                    H·ªßy
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  const CategoryManagement = () => {
    const handleAddCategory = () => {
      setEditingCategory({ id: null, name: '', icon: 'üìå', order: categories.length + 1 });
      setShowCategoryModal(true);
    };

    const handleEditCategory = (category) => {
      setEditingCategory(category);
      setShowCategoryModal(true);
    };

    const handleDeleteCategory = (id) => {
      if (services.some(s => s.categoryId === id)) {
        alert('Kh√¥ng th·ªÉ x√≥a danh m·ª•c ƒëang c√≥ d·ªãch v·ª•!');
        return;
      }
      if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a danh m·ª•c n√†y?')) {
        setCategories(categories.filter(c => c.id !== id));
      }
    };

    const handleSaveCategory = () => {
      if (editingCategory.id) {
        setCategories(categories.map(c => c.id === editingCategory.id ? editingCategory : c));
      } else {
        setCategories([...categories, { ...editingCategory, id: Math.max(...categories.map(c => c.id)) + 1 }]);
      }
      setShowCategoryModal(false);
      setEditingCategory(null);
    };

    return (
      <div>
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-2xl font-bold" style={{ color: themeColors.textPrimary }}>Qu·∫£n L√Ω Danh M·ª•c</h2>
          <button
            onClick={handleAddCategory}
            className="px-6 py-3 rounded-lg font-semibold flex items-center gap-2"
            style={{ backgroundColor: themeColors.secondary }}
          >
            <Plus size={20} /> Th√™m Danh M·ª•c
          </button>
        </div>

        <div className="grid gap-4">
          {categories.sort((a, b) => a.order - b.order).map(category => (
            <div key={category.id} className="flex items-center justify-between p-6 rounded-lg" style={{ backgroundColor: themeColors.cardBg }}>
              <div className="flex items-center gap-4">
                <span className="text-4xl">{category.icon}</span>
                <div>
                  <p className="text-xl font-bold" style={{ color: themeColors.textPrimary }}>{category.name}</p>
                  <p className="text-sm" style={{ color: themeColors.textSecondary }}>
                    Th·ª© t·ª±: {category.order} | S·ªë d·ªãch v·ª•: {services.filter(s => s.categoryId === category.id).length}
                  </p>
                </div>
              </div>
              <div className="flex gap-2">
                <button onClick={() => handleEditCategory(category)} className="p-3 rounded" style={{ backgroundColor: themeColors.secondary }}>
                  <Edit2 size={20} />
                </button>
                <button onClick={() => handleDeleteCategory(category.id)} className="p-3 rounded bg-red-600">
                  <Trash2 size={20} />
                </button>
              </div>
            </div>
          ))}
        </div>

        {showCategoryModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={() => setShowCategoryModal(false)}>
            <div className="bg-gray-800 p-8 rounded-lg w-full max-w-md" onClick={e => e.stopPropagation()} style={{ backgroundColor: themeColors.cardBg }}>
              <h2 className="text-2xl font-bold mb-6" style={{ color: themeColors.secondary }}>
                {editingCategory?.id ? 'Ch·ªânh S·ª≠a Danh M·ª•c' : 'Th√™m Danh M·ª•c M·ªõi'}
              </h2>
              
              <div className="space-y-4">
                <div>
                  <label className="block mb-2" style={{ color: themeColors.textPrimary }}>T√™n Danh M·ª•c</label>
                  <input
                    type="text"
                    value={editingCategory.name}
                    onChange={(e) => setEditingCategory({ ...editingCategory, name: e.target.value })}
                    className="w-full p-3 rounded bg-gray-700 text-white"
                    placeholder="Nh·∫≠p t√™n danh m·ª•c"
                  />
                </div>

                <div>
                  <label className="block mb-2" style={{ color: themeColors.textPrimary }}>Icon (Emoji)</label>
                  <input
                    type="text"
                    value={editingCategory.icon}
                    onChange={(e) => setEditingCategory({ ...editingCategory, icon: e.target.value })}
                    className="w-full p-3 rounded bg-gray-700 text-white"
                    placeholder="üìå"
                  />
                </div>

                <div>
                  <label className="block mb-2" style={{ color: themeColors.textPrimary }}>Th·ª© T·ª±</label>
                  <input
                    type="number"
                    value={editingCategory.order}
                    onChange={(e) => setEditingCategory({ ...editingCategory, order: parseInt(e.target.value) || 1 })}
                    className="w-full p-3 rounded bg-gray-700 text-white"
                    placeholder="1"
                  />
                </div>

                <div className="flex gap-4 mt-6">
                  <button onClick={handleSaveCategory} className="flex-1 p-3 rounded font-bold" style={{ backgroundColor: themeColors.secondary }}>
                    <Save className="inline mr-2" size={20} /> L∆∞u
                  </button>
                  <button onClick={() => setShowCategoryModal(false)} className="flex-1 p-3 rounded font-bold bg-gray-600">
                    H·ªßy
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  const PrizeManagement = () => {
    const handleAddPrize = () => {
      setEditingPrize({ id: null, discount: 10, probability: 10, color: '#FFD700', categoryIds: [] });
      setShowPrizeModal(true);
    };

    const handleEditPrize = (prize) => {
      setEditingPrize(prize);
      setShowPrizeModal(true);
    };

    const handleDeletePrize = (id) => {
      if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a gi·∫£i th∆∞·ªüng n√†y?')) {
        setPrizes(prizes.filter(p => p.id !== id));
      }
    };

    const handleSavePrize = () => {
      if (editingPrize.id) {
        setPrizes(prizes.map(p => p.id === editingPrize.id ? editingPrize : p));
      } else {
        setPrizes([...prizes, { ...editingPrize, id: Math.max(...prizes.map(p => p.id)) + 1 }]);
      }
      setShowPrizeModal(false);
      setEditingPrize(null);
    };

    const toggleCategory = (catId) => {
      const current = editingPrize.categoryIds || [];
      const updated = current.includes(catId) ? current.filter(id => id !== catId) : [...current, catId];
      setEditingPrize({ ...editingPrize, categoryIds: updated });
    };

    return (
      <div>
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-2xl font-bold" style={{ color: themeColors.textPrimary }}>Qu·∫£n L√Ω Gi·∫£i Th∆∞·ªüng V√≤ng Quay</h2>
          <button
            onClick={handleAddPrize}
            className="px-6 py-3 rounded-lg font-semibold flex items-center gap-2"
            style={{ backgroundColor: themeColors.accent, color: themeColors.background }}
          >
            <Plus size={20} /> Th√™m Gi·∫£i Th∆∞·ªüng
          </button>
        </div>

        <div className="grid gap-4">
          {prizes.map(prize => (
            <div key={prize.id} className="flex items-center justify-between p-6 rounded-lg" style={{ backgroundColor: themeColors.cardBg }}>
              <div className="flex items-center gap-4">
                <div className="w-16 h-16 rounded-full flex items-center justify-center text-white font-bold text-xl" style={{ backgroundColor: prize.color }}>
                  -{prize.discount}%
                </div>
                <div>
                  <p className="text-xl font-bold" style={{ color: themeColors.textPrimary }}>
                    Gi·∫£m gi√° {prize.discount}%
                  </p>
                  <p className="text-sm" style={{ color: themeColors.textSecondary }}>
                    X√°c su·∫•t: {prize.probability}% | 
                    {prize.categoryIds.length === 0 ? ' √Åp d·ª•ng t·∫•t c·∫£ d·ªãch v·ª•' : 
                      ` √Åp d·ª•ng ${prize.categoryIds.length} danh m·ª•c`}
                  </p>
                </div>
              </div>
              <div className="flex gap-2">
                <button onClick={() => handleEditPrize(prize)} className="p-3 rounded" style={{ backgroundColor: themeColors.accent, color: themeColors.background }}>
                  <Edit2 size={20} />
                </button>
                <button onClick={() => handleDeletePrize(prize.id)} className="p-3 rounded bg-red-600">
                  <Trash2 size={20} />
                </button>
              </div>
            </div>
          ))}
        </div>

        {showPrizeModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={() => setShowPrizeModal(false)}>
            <div className="bg-gray-800 p-8 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()} style={{ backgroundColor: themeColors.cardBg }}>
              <h2 className="text-2xl font-bold mb-6" style={{ color: themeColors.accent }}>
                {editingPrize?.id ? 'Ch·ªânh S·ª≠a Gi·∫£i Th∆∞·ªüng' : 'Th√™m Gi·∫£i Th∆∞·ªüng M·ªõi'}
              </h2>
              
              <div className="space-y-4">
                <div>
                  <label className="block mb-2" style={{ color: themeColors.textPrimary }}>Ph·∫ßn TrƒÉm Gi·∫£m Gi√° (%)</label>
                  <input
                    type="number"
                    value={editingPrize.discount}
                    onChange={(e) => setEditingPrize({ ...editingPrize, discount: parseInt(e.target.value) || 0 })}
                    className="w-full p-3 rounded bg-gray-700 text-white"
                    placeholder="10"
                    min="1"
                    max="100"
                  />
                </div>

                <div>
                  <label className="block mb-2" style={{ color: themeColors.textPrimary }}>X√°c Su·∫•t Tr√∫ng (%)</label>
                  <input
                    type="number"
                    value={editingPrize.probability}
                    onChange={(e) => setEditingPrize({ ...editingPrize, probability: parseInt(e.target.value) || 0 })}
                    className="w-full p-3 rounded bg-gray-700 text-white"
                    placeholder="10"
                    min="1"
                    max="100"
                  />
                  <p className="text-xs mt-1" style={{ color: themeColors.textSecondary }}>
                    T·ªïng x√°c su·∫•t t·∫•t c·∫£ gi·∫£i n√™n = 100%
                  </p>
                </div>

                <div>
                  <label className="block mb-2" style={{ color: themeColors.textPrimary }}>M√†u S·∫Øc</label>
                  <input
                    type="color"
                    value={editingPrize.color}
                    onChange={(e) => setEditingPrize({ ...editingPrize, color: e.target.value })}
                    className="w-full h-12 rounded bg-gray-700"
                  />
                </div>

                <div>
                  <label className="block mb-2" style={{ color: themeColors.textPrimary }}>
                    √Åp D·ª•ng Cho Danh M·ª•c (ƒê·ªÉ tr·ªëng = T·∫•t c·∫£)
                  </label>
                  <div className="grid grid-cols-2 gap-2 max-h-48 overflow-y-auto p-3 rounded bg-gray-700">
                    {categories.map(cat => (
                      <label key={cat.id} className="flex items-center gap-2 cursor-pointer p-2 rounded hover:bg-gray-600">
                        <input
                          type="checkbox"
                          checked={(editingPrize.categoryIds || []).includes(cat.id)}
                          onChange={() => toggleCategory(cat.id)}
                        />
                        <span style={{ color: themeColors.textPrimary }}>{cat.icon} {cat.name}</span>
                      </label>
                    ))}
                  </div>
                </div>

                <div className="flex gap-4 mt-6">
                  <button onClick={handleSavePrize} className="flex-1 p-3 rounded font-bold" style={{ backgroundColor: themeColors.accent, color: themeColors.background }}>
                    <Save className="inline mr-2" size={20} /> L∆∞u
                  </button>
                  <button onClick={() => setShowPrizeModal(false)} className="flex-1 p-3 rounded font-bold bg-gray-600">
                    H·ªßy
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  const ThemeCustomization = () => {
    const [tempColors, setTempColors] = useState(themeColors);

    const handleSaveColors = () => {
      setThemeColors(tempColors);
      alert('ƒê√£ l∆∞u c·∫•u h√¨nh m√†u s·∫Øc!');
    };

    const presetThemes = [
      { name: 'M·∫∑c ƒê·ªãnh', colors: { primary: '#FF6B6B', secondary: '#4ECDC4', accent: '#FFE66D', background: '#0F172A', cardBg: '#1E293B', textPrimary: '#F1F5F9', textSecondary: '#94A3B8' }},
      { name: 'Xanh D∆∞∆°ng', colors: { primary: '#3B82F6', secondary: '#10B981', accent: '#FBBF24', background: '#111827', cardBg: '#1F2937', textPrimary: '#F9FAFB', textSecondary: '#9CA3AF' }},
      { name: 'T√≠m', colors: { primary: '#9333EA', secondary: '#EC4899', accent: '#F59E0B', background: '#18181B', cardBg: '#27272A', textPrimary: '#FAFAFA', textSecondary: '#A1A1AA' }},
      { name: 'Xanh L√°', colors: { primary:
